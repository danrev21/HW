===================================================================================================================
# ADD 
копирует новые файлы, каталоги или URL-адреса удаленных файлов <src> и добавляет их в файловую систему образа по пути <dest>.
имеет две формы:

  ADD [--chown=<user>:<group>] [--chmod=<perms>] [--checksum=<checksum>] <src>... <dest>
  ADD [--chown=<user>:<group>] [--chmod=<perms>] ["<src>",... "<dest>"]
  
  Последняя форма требуется для путей, содержащих пробелы.  
  Можно указать несколько <src> ресурсов, но если они являются файлами или каталогами, их пути интерпретируются как относительные к источнику контекста сборки.
  
ADD hom* /mydir/
ADD hom?.txt /mydir/
ADD test.txt relativeDir/
ADD test.txt /absoluteDir/

  Чтобы добавить файл с именем arr[0].txt:

ADD arr[[]0].txt /mydir/

  Все новые файлы и каталоги создаются с UID и GID, равными 0, если только необязательный --chown флаг не указывает данное имя пользователя, имя группы или комбинацию UID/GID для запроса конкретного владельца добавленного контента:

ADD --chown=55:mygroup files* /somedir/
ADD --chown=bin files* /somedir/
ADD --chown=1 files* /somedir/
ADD --chown=10:11 files* /somedir/
ADD --chown=myuser:mygroup --chmod=655 files* /somedir/

  Если корневая файловая система контейнера не содержит ни файлов /etc/passwd, ни /etc/group файлов, а в флаге используются имена пользователей или групп --chown , сборка завершится ошибкой ADD. Использование числовых идентификаторов не требует поиска и не будет зависеть от содержимого корневой файловой системы контейнера.

  Примечание:
  Если вы строите, передавая Dockerfileчерез STDIN ( docker build - < somefile), контекст сборки отсутствует, поэтому может Dockerfile содержать только инструкцию на основе URL ADD. Вы также можете передать сжатый архив через STDIN: ( docker build - < archive.tar.gz), Dockerfile корень архива и остальная часть архива будут использоваться в качестве контекста сборки.

  Если ваши файлы URL защищены с помощью аутентификации, вам необходимо использовать RUN wget или RUN curl использовать другой инструмент из контейнера, поскольку инструкция ADD не поддерживает аутентификацию.

  Примечание:
  Первая обнаруженная ADD инструкция сделает кэш недействительным для всех последующих инструкций из Dockerfile, если содержимое файла <src> изменилось. Это включает в себя аннулирование кеша для RUN инструкций. Дополнительную информацию см. в Dockerfile руководстве по передовым методам — использование кэша сборки.

  ADD подчиняется следующим правилам:
 1. Путь <src> должен быть внутри контекста сборки; вы не можете ADD ../something /something, потому что первым шагом docker buildявляется отправка каталога контекста (и подкаталогов) демону докера.
 2. Если <src> это URL-адрес и <dest> не заканчивается косой чертой, то файл загружается с URL-адреса и копируется в <dest>.
 3. Если <src> это URL-адрес и <dest> заканчивается косой чертой, то имя файла выводится из URL-адреса, и файл загружается в <dest>/<filename>. Например, ADD http://example.com/foobar /создаст файл /foobar. URL-адрес должен иметь нетривиальный путь, чтобы в этом случае можно было найти подходящее имя файла ( http://example.com не будет работать).
 4. Если <src> это каталог, копируется все содержимое каталога, включая метаданные файловой системы (копируется, только его содержимое).
 5. Если <src> это локальный tar-архив в распознаваемом формате сжатия (identity, gzip, bzip2 или xz), то он распаковывается как каталог. Ресурсы с удаленных URL-адресов не распаковываются. Когда каталог копируется или распаковывается, он ведет себя так же, как и tar -x.
 6. Если <src> это файл любого другого типа, он копируется отдельно вместе с его метаданными. В этом случае, если <dest> заканчивается косой чертой /, он будет считаться каталогом, а содержимое <src> будет записано по адресу <dest>/base(<src>).
 7. Если указано несколько <src> ресурсов, либо напрямую, либо из-за использования подстановочного знака, то <dest> должен быть каталог, и он должен заканчиваться косой чертой /.
 8. Если <dest> не заканчивается косой чертой, он будет считаться обычным файлом, а содержимое <src> будет записано в <dest>.
 9. Если <dest> не существует, он создается вместе со всеми отсутствующими каталогами на его пути.

  Проверка контрольной суммы удаленного файла ADD --checksum=<checksum> <http src> <dest>:

ADD --checksum=sha256:24454f830cdb571e2c4ad15481119c43b3cafd48dd869a9b2945d1036d1dc68d https://mirrors.edge.kernel.org/pub/linux/kernel/Historic/linux-0.01.tar.gz /

  В настоящее время флаг --checksumподдерживает только источники HTTP.

  Добавление репозитория git ADD <git ref> <dir>. Эта форма позволяет добавить git-репозиторий в образ напрямую, без использования git команды внутри образа:

ADD [--keep-git-dir=<boolean>] <git ref> <dir>

# syntax=docker/dockerfile:1
FROM alpine
ADD --keep-git-dir=true https://github.com/moby/buildkit.git#v0.10.1 /buildkit

  Флаг --keep-git-dir=true добавляет .git каталог. Этот флаг по умолчанию имеет значение false.

  Добавление приватного репозитория git. Чтобы добавить частное репо через SSH, создайте Dockerfile со следующей формой:

# syntax=docker/dockerfile:1
FROM alpine
ADD git@git.example.com:foo/bar.git /bar

  Этот Dockerfile может быть создан с помощью docker build --ssh или buildctl build --ssh, например:

docker build --ssh default

buildctl build --frontend=dockerfile.v0 --local context=. --local dockerfile=. --ssh default

