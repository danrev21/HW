===================================================================================================================
# COPY --link
Добавлено вdocker/dockerfile:1.4

  Включение этого флага в командах COPY или ADD позволяет копировать файлы с расширенной семантикой, при этом ваши файлы остаются независимыми на своем собственном уровне и не становятся недействительными при изменении команд на предыдущих уровнях.
  При --link использовании ваши исходные файлы копируются в пустой каталог назначения. Этот каталог превращается в слой, который связан поверх вашего предыдущего состояния.

# syntax=docker/dockerfile:1
FROM alpine
COPY --link /foo /bar
  Эквивалентно выполнению двух сборок:

FROM alpine
  и
FROM scratch
COPY /foo /bar
  и слияние всех слоев обоих изображений вместе.

  Преимущества использования --link
Используйте --link для повторного использования уже созданных слоев в последующих сборках, --cache-from даже если предыдущие слои изменились. Это особенно важно для многоэтапных сборок, когда COPY --from оператор ранее становился недействительным, если изменялись какие-либо предыдущие команды на том же этапе, что вызывало необходимость повторного перестроения промежуточных этапов. Имея --link слой, сгенерированный предыдущей сборкой, он используется повторно и объединяется поверх новых слоев. Это также означает, что вы можете легко переустанавливать свои образы, когда базовые образы получают обновления, без необходимости повторного выполнения всей сборки. В бэкендах, которые его поддерживают, BuildKit может выполнять это действие перебазирования без необходимости push или pull какие-либо слои между клиентом и registry. BuildKit обнаружит этот случай и создаст только новый манифест образа, который содержит новые слои и старые слои в правильном порядке.

То же самое поведение, когда BuildKit может избежать pull базового образа, также может иметь место при использовании --link и никаких других команд, которые требуют доступа к файлам в базовом образе. В этом случае BuildKit создаст только слои для COPY команд и поместит их в registry непосредственно поверх слоев базового образа.
  
Несовместимость с --link=false
При использовании --link команды COPY/ADD не разрешается читать какие-либо файлы из предыдущего состояния. Это означает, что если в предыдущем состоянии целевым каталогом был путь, содержащий символическую ссылку, то COPY/ADD не могут по ней перейти. В конечном образе путь назначения, созданный с помощью, --link всегда будет путем, содержащим только каталоги.

Если вы не полагаетесь на поведение следующих символических ссылок в пути назначения, всегда рекомендуется использование --link. Производительность --link эквивалентна или лучше, чем поведение по умолчанию, и создает гораздо лучшие условия для повторного использования кэша.
